<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misiro - Learn German</title>
    <link rel="stylesheet" href="styles.css?v=6">
</head>

<body>

    <!-- Audio Unlock Overlay -->
    <div id="start-overlay"
        style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; display:flex; justify-content:center; align-items:center; flex-direction:column; color:white;">
        <h1>Ready to Learn?</h1>
        <p style="margin:20px 0; font-size:1.2em;">Tap start to enable audio & voice.</p>
        <button id="btn-start-lesson"
            style="padding:15px 40px; font-size:1.5em; background:#4CAF50; color:white; border:none; border-radius:50px; cursor:pointer;">
            â–¶ Start Lesson
        </button>
    </div>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <a href="home.html"
                    style="display:flex; align-items:center; gap:5px; padding:8px 15px; background:#4CAF50; border-radius:20px; color:#fff; text-decoration:none; font-weight:600; margin-right:10px; transition:all 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.2);"
                    onmouseover="this.style.background='#45a049'" onmouseout="this.style.background='#4CAF50'">â†
                    Home</a>
                <h1>ğŸŒ Misiro</h1>
            </div>
            <div class="day-selection-control">
                <label for="day-select">ğŸ“… Day:</label>
                <select id="day-select">
                    <!-- Populated dynamically by app.js -->
                </select>
            </div>
            <div class="blind-mode-control" style="display:flex; align-items:center; gap:5px;">
                <input type="checkbox" id="blind-mode-toggle" style="width:18px; height:18px; cursor:pointer;">
                <label for="blind-mode-toggle" style="font-weight:600; cursor:pointer;">ğŸ™ˆ Blind Mode</label>
            </div>
            <div class="language-control" style="display:flex; align-items:center; gap:5px;">
                <select id="language-select"
                    style="padding:5px 10px; border-radius:8px; font-weight:600; cursor:pointer;">
                    <option value="fa">ğŸ‡®ğŸ‡· ÙØ§Ø±Ø³ÛŒ</option>
                    <option value="en">ğŸ‡¬ğŸ‡§ English</option>
                </select>
            </div>
            <div class="speed-control" style="display:flex; align-items:center; gap:5px;">
                <select id="speed-select" style="padding:5px 10px; border-radius:8px; font-weight:600; cursor:pointer;">
                    <option value="1">ğŸ”Š 1x</option>
                    <option value="0.75">ğŸ”‰ 0.75x</option>
                    <option value="0.5">ğŸ¢ 0.5x</option>
                    <option value="0.25">ğŸŒ 0.25x</option>
                </select>
            </div>
            <!-- Voice Eval Removed -->

            <div class="progress-info">
                <span>Level <span id="current-level">1</span> / 100</span>
                <span>Scenario <span id="current-scenario">1</span> / 10</span>
            </div>
        </header>

        <!-- Main Learning Area -->
        <main class="learning-area">
            <!-- Chat Interface -->
            <div class="chat-wrapper">

                <!-- 1. Chat Header -->
                <div class="chat-header">
                    <div class="avatar-circle">â˜•ï¸</div>
                    <div class="header-info">
                        <h3 id="scenario-title-text">The CafÃ©</h3>
                        <span class="status">Online</span>
                    </div>
                </div>

                <!-- 2. Message History (Scrollable) -->
                <div class="chat-history" id="chat-history">
                    <div class="date-divider">Today</div>
                </div>

                <!-- 3. Interaction Area (Bottom Fixed) -->
                <div class="chat-interaction-area">

                    <!-- The "Draft" the user is building -->
                    <div class="message-composer" id="answer-line">
                        <span class="placeholder-text">Tap words to reply...</span>
                    </div>

                    <!-- Action Button (Send/Mic) -->
                    <button class="btn-send" id="btn-send" style="display:flex;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                            <path
                                d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                        </svg>
                    </button>

                    <!-- Word Bank -->
                    <div class="word-bank-scroll" id="word-bank" style="display:none;"></div>

                </div>

            </div>
        </main>

        <!-- Script View Sidebar (on mobile: bottom panel with drag handle) -->
        <aside class="script-view" id="script-view">
            <div class="script-drag-handle" id="script-drag-handle">
                <div class="handle-bar"></div>
            </div>
            <h3>Current Script ğŸ“œ</h3>
            <div id="script-container">
                <!-- Dynamically filled with sentences -->
            </div>
        </aside>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="config.js"></script>
    <script src="supabase-client.js"></script>
    <script src="data-layer.js"></script>
    <script src="ai-integration.js"></script>
    <script src="lessons_data.js"></script>
    <script src="app.js?v=6"></script>
</body>

</html>